<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aura Real-Time Uptime Monitor</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { font-family: sans-serif; }
        .latency { text-align: right; }
        .status-badge { font-size: 0.9em; font-weight: bold; }
    </style>
</head>
<body>

    <div class="container mt-4">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <div>
                <h1 class="mb-0">Aura Uptime Monitor</h1>
                <p class="text-muted">A real-time status check of your configured services.</p>
            </div>
            <div>
                <small class="text-muted">Last updated: <span id="last-updated">Never</span></small>
            </div>
        </div>

        <div class="table-responsive">
            <table class="table table-hover align-middle">
                <thead class="table-dark">
                    <tr>
                        <th>Service Name</th>
                        <th>URL</th>
                        <th class="text-center">Status</th>
                        <th class="text-center">Code</th>
                        <th class="text-end">Latency (ms)</th>
                    </tr>
                </thead>
                <tbody id="monitor-table-body">
                    <tr>
                        <td colspan="5" class="text-center p-4">
                            <div class="spinner-border" role="status">
                                <span class="visually-hidden">Loading...</span>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <footer class="text-center text-muted mt-4">
            <p>Page will automatically refresh every 15 seconds.</p>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const tableBody = document.getElementById('monitor-table-body');
            const lastUpdatedSpan = document.getElementById('last-updated');

            const fetchStatus = async () => {
                try {
                    const response = await fetch('/api/status');
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    const data = await response.json();

                    // Clear previous content
                    tableBody.innerHTML = '';

                    data.forEach(monitor => {
                        let statusClass = '';
                        switch (monitor.status) {
                            case 'Up':
                                statusClass = 'bg-success';
                                break;
                            case 'Down':
                                statusClass = 'bg-warning';
                                break;
                            case 'Error':
                                statusClass = 'bg-danger';
                                break;
                        }

                        const row = `
                            <tr>
                                <td><strong>${monitor.name}</strong></td>
                                <td><a href="${monitor.url}" target="_blank">${monitor.url}</a></td>
                                <td class="text-center">
                                    <span class="badge ${statusClass} status-badge">${monitor.status}</span>
                                </td>
                                <td class="text-center">${monitor.status_code || 'N/A'}</td>
                                <td class="text-end">${monitor.latency_ms || 'N/A'}</td>
                            </tr>
                        `;
                        tableBody.innerHTML += row;
                    });
                    
                    lastUpdatedSpan.textContent = new Date().toLocaleTimeString();

                } catch (error) {
                    console.error("Failed to fetch status:", error);
                    tableBody.innerHTML = `<tr><td colspan="5" class="text-center text-danger">Failed to load status. Is the backend server running?</td></tr>`;
                }
            };

            // Fetch data immediately on page load
            fetchStatus();

            // Then fetch data every 15 seconds
            setInterval(fetchStatus, 15000);
        });
    </script>
</body>
</html>
